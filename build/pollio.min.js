// PollIO v0.0.3 (c) Attachments.me
function PollIO(a,b){if(typeof(a)=="object"){b=a;a=undefined}b=b||{};this.ajax=a||jQuery.ajax;this.eventLoopInterval=b.eventLoopInterval||1000;this.pendingRequests={};this.pollLookup={};this.pollIdentifier=0;if(b.autoStart!==false){this.start()}}PollIO.prototype.schedule=function(b){var a={onResults:function(d,c){},onFailure:function(){},frequency:1000,max:-1,pollCount:0,iterationCount:0,identifier:++this.pollIdentifier,ajax:null};b.ajaxParams=this._getAjaxParams(b,a);this._update(b,a);b.mod=this._calculateMod(b.frequency);if(this.pollLookup[b.identifier]){return}this.pollLookup[b.identifier]=b};PollIO.prototype._calculateMod=function(a){if(a<this.eventLoopInterval){return 1}return parseInt(a/this.eventLoopInterval)};PollIO.prototype._update=function(d,c){for(var e in c){if(c.hasOwnProperty(e)){if(!d[e]){d[e]=c[e]}}}};PollIO.prototype._getAjaxParams=function(d,c){var f={};for(var e in d){if(d.hasOwnProperty(e)){if(c[e]===undefined){f[e]=d[e];delete d[e]}}}return f};PollIO.prototype.start=function(){var a=this;this.intervalId=setInterval(function(){a._handlePolling()},this.eventLoopInterval)};PollIO.prototype.stop=function(){clearInterval(this.intervalId)};PollIO.prototype._handlePolling=function(){var c=this;for(var a in this.pollLookup){if(this.pollLookup.hasOwnProperty(a)){var b=this.pollLookup[a];if(((b.iterationCount++)%b.mod)==0){if(!this._stopIterating(b)){this._handleAjaxCall(b)}}}}};PollIO.prototype._stopIterating=function(a){if(a.pollCount++==a.max){delete this.pollLookup[a.identifier];a.onFailure();return true}return false};PollIO.prototype._handleAjaxCall=function(a){var b=this;if(this.pendingRequests[a.identifier]){return}this.pendingRequests[a.identifier]=true;a.ajaxParams.success=function(c){delete b.pendingRequests[a.identifier];a.onResults(c,function(){delete b.pollLookup[a.identifier]})};if(a.ajax){a.ajax(a.ajaxParams)}else{this.ajax(a.ajaxParams)}};if(typeof(exports)!=="undefined"){exports.PollIO=PollIO};